---
import { Aside } from '@astrojs/starlight/components';
---
<div id="pledge-container">
  <form id="pledge-form" method="POST">
    <h2>Sign the pledge to support GuardPact!</h2>
    <div>
      <label for="firstName">First Name <span>*</span></label>
      <input type="text" id="firstName" name="firstName" required placeholder="Jane" />
    </div>
    <div>
      <label for="lastName">Last Name <span>*</span></label>
      <input type="text" id="lastName" name="lastName" required placeholder="Doe" />
    </div>
    <div>
      <label for="email">Email <span>*</span></label>
      <input type="email" id="email" name="email" required placeholder="jane.doe@example.com" />
    </div>
    <div>
      <label for="state">State <span>*</span></label>
      <select id="state" name="state" required>
        <option value="" disabled selected>Select your state</option>
        <option value="AL">Alabama</option>
        <option value="AK">Alaska</option>
        <option value="AZ">Arizona</option>
        <option value="AR">Arkansas</option>
        <option value="CA">California</option>
        <option value="CO">Colorado</option>
        <option value="CT">Connecticut</option>
        <option value="DE">Delaware</option>
        <option value="DC">District Of Columbia</option>
        <option value="FL">Florida</option>
        <option value="GA">Georgia</option>
        <option value="HI">Hawaii</option>
        <option value="ID">Idaho</option>
        <option value="IL">Illinois</option>
        <option value="IN">Indiana</option>
        <option value="IA">Iowa</option>
        <option value="KS">Kansas</option>
        <option value="KY">Kentucky</option>
        <option value="LA">Louisiana</option>
        <option value="ME">Maine</option>
        <option value="MD">Maryland</option>
        <option value="MA">Massachusetts</option>
        <option value="MI">Michigan</option>
        <option value="MN">Minnesota</option>
        <option value="MS">Mississippi</option>
        <option value="MO">Missouri</option>
        <option value="MT">Montana</option>
        <option value="NE">Nebraska</option>
        <option value="NV">Nevada</option>
        <option value="NH">New Hampshire</option>
        <option value="NJ">New Jersey</option>
        <option value="NM">New Mexico</option>
        <option value="NY">New York</option>
        <option value="NC">North Carolina</option>
        <option value="ND">North Dakota</option>
        <option value="OH">Ohio</option>
        <option value="OK">Oklahoma</option>
        <option value="OR">Oregon</option>
        <option value="PA">Pennsylvania</option>
        <option value="RI">Rhode Island</option>
        <option value="SC">South Carolina</option>
        <option value="SD">South Dakota</option>
        <option value="TN">Tennessee</option>
        <option value="TX">Texas</option>
        <option value="UT">Utah</option>
        <option value="VT">Vermont</option>
        <option value="VA">Virginia</option>
        <option value="WA">Washington</option>
        <option value="WV">West Virginia</option>
        <option value="WI">Wisconsin</option>
        <option value="WY">Wyoming</option>
      </select>
    </div>
    <div>
      <label for="zip">Zip Code</label>
      <input type="text" id="zip" name="zip" placeholder="90210" />
    </div>
    <button type="submit">Sign the Pledge</button>
    <p class="privacy-note">By signing, you agree to our <a href="/privacy">Privacy Policy</a>.</p>
  </form>

  <div id="success-message" style="display: none;">
    <Aside type="note" title="Welcome, Guardian.">
      <p>
        Thank you for taking a stand for a smarter, more accountable government.
      </p>
      <p>
        Your voice has been added. Together, we are building a mandate for change that cannot be ignored.
      </p>
    </Aside>

    <h2>What's Next?</h2>

    <div>
        <h3>1. Read the Latest</h3>
        <p>Stay informed with our latest analysis and updates. We break down complex issues into clear, evidence-based insights.</p>
        <a href="/blog">Read the Blog &rarr;</a>
    </div>
    <div>
        <h3>2. Spread the Word</h3>
        <p>The Guard Pact grows stronger with every voice. Share it with friends, family, and on social media.</p>
        <a href="https://x.com/intent/tweet?text=I%20just%20signed%20the%20Guard%20Pact%20to%20demand%20a%20smarter%2C%20more%20accountable%20government.%20Join%20me%3A&url=https://guardpact.us/pledge" target="_blank">Share on X &rarr;</a>
    </div>
    <div>
        <h3>3. Dive Deeper</h3>
        <p>Explore the <a href="/docs/02-essential-points">19 Essential Points</a> of the Guard Pact and see the evidence-backed policies that form our framework.</p>
        <a href="/docs/02-essential-points">Explore the Policies &rarr;</a>
    </div>
  </div>
</div>

<style>
  #pledge-container {
    max-width: 600px;
    margin: 2rem auto;
    padding: 2rem;
    border: 1px solid var(--sl-color-gray-5);
    border-radius: 8px;
  }
  #pledge-form h2 {
    margin-top: 0;
  }
  #pledge-form div {
    margin-bottom: 1rem;
  }
  #pledge-form label {
    display: block;
    margin-bottom: 0.25rem;
  }
  #pledge-form label span {
    color: var(--sl-color-red);
  }
  #pledge-form input, #pledge-form select {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid var(--sl-color-gray-5);
    border-radius: 4px;
    background-color: var(--sl-color-bg);
    color: var(--sl-color-text);
  }
  #pledge-form button {
    width: 100%;
    padding: 0.75rem;
    border: none;
    border-radius: 4px;
    background-color: var(--sl-color-accent);
    color: #FFFFFF;
    font-weight: bold;
    cursor: pointer;
  }
  #success-message h2 {
    margin-top: 2rem;
    border-top: 1px solid var(--sl-color-gray-5);
    padding-top: 1.5rem;
  }
  #success-message h3 {
    margin-bottom: 0.5rem;
  }
  #success-message > div:not(:first-of-type) {
    margin-top: 1.5rem;
  }
  #success-message a {
    text-decoration: none;
    font-weight: bold;
  }
</style>

<script is:inline>
  const form = document.getElementById('pledge-form');
  const successMessage = document.getElementById('success-message');

  if (form && successMessage) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      const response = await fetch('/api/pledge', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      });

      if (response.ok) {
        form.style.display = 'none';
        successMessage.style.display = 'block';
      }
    });
  }
</script>
